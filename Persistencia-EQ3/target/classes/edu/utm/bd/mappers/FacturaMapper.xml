<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.utm.bd.mappers.FacturaMapper">
  <resultMap id="BaseResultMap" type="edu.utm.bd.domain.Factura">
  
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 25 18:12:03 CDT 2018.
    -->
    <id column="id_factura" jdbcType="INTEGER" property="idFactura" />
    <result column="id_venta" jdbcType="INTEGER" property="idVenta" />
  </resultMap>
	
	<insert id="insertFactura" parameterType="edu.utm.bd.domain.Factura">
  		INSERT INTO FACTURA VALUES (#{idFactura}, #{idVenta})
	</insert>
	
	<select id="folioFactura" resultMap="BaseResultMap">
		select factura.id_factura as idFactura, factura.id_venta as idVenta, 
		venta.num_venta as numVenta from factura inner join venta on factura.id_venta=venta.id_venta;
	</select>
	
	<resultMap id="ResultFacturaVenta" type="edu.utm.bd.domain.Factura">
		<id column="id_factura" property="idFactura" />    	
    	<result column="id_cliente" property="venta.idCliente" />
    	<result column="id_producto" property="venta.idProducto" />
    	<result column="fecha" property="fecha" />
    	<result column="id_venta" property="venta.idVenta" />
    	<result column="nombre" property="nombre" />
    	<result column="domicilio" property="domicilio" />
    	<result column="rfc" property="rfc" />
    	<result column="email" property="email" />
    	<result column="telefono" property="telefono" />
    	<result column="tipo" property="producto.tipo" />
    	<result column="marca" property="producto.marca" />
    	<result column="cantidad" property="cantidad" />
    	<result column="descripcion" property="descripcion" />
    	<result column="precio_venta" property="producto.precioVenta" />    	
	</resultMap>
	<select id="datosFactura" resultMap="ResultFacturaVenta" parameterType="integer">
		SELECT venta.fecha as fecha, cliente.nombre as nombre, cliente.domicilio as domicilio, cliente.rfc
		as rfc, cliente.email as email, cliente.telefono as telefono FROM ( VENTA inner join CLIENTE 
		ON venta.id_venta =#{idVenta} and venta.id_cliente=cliente.id_cliente)
	
	</select>
  	<select id="findAllVenta" resultMap="ResultFacturaVenta" parameterType="integer">  		
  		SELECT venta.id_producto as idProducto, venta.cantidad as cantidad, producto.descripcion as descripcion, 
  		producto.precio_venta as precioVenta, (venta.cantidad * producto.precio_venta) AS importe FROM VENTA 
  		inner join PRODUCTO WHERE num_venta=#{numVenta} and venta.id_producto=producto.id_producto
    </select>
    <select id="totalVenta" resultMap="ResultFacturaVenta" parameterType="integer">    
    	SELECT sum(venta.cantidad * producto.precio_venta) as total from VENTA inner 
    	join PRODUCTO where num_venta=#{numVenta} and venta.id_producto=producto.id_producto
    </select>
</mapper>